{% extends "libstat/base.html" %}
{% load i18n %}
{% load libstat_tags %}

{% block content %}
    <style>
        .section-title {
            color: rgb(242, 148, 0)
        }

        .section-comment {
            width: 100%;
            height: 100%;
        }

        .cell .input-group input {
            padding-right: 34px;
        }

        .cell .input-group-btn .btn-dropdown {
            border-radius: 0;
        }

        .cell .input-group input[disabled] {
            font-style: italic;
        }

        .row-description {
            display: flex;
            align-items: center;
        }

        .container-survey {
            padding-bottom: 120px;
        }

        .answers-progress {
            margin-bottom: 0;
        }

        .navbar-submit {
            margin-top: 10px;
        }

        ::-webkit-input-placeholder {
            font-style: italic;
        }

    </style>

    {% if user.is_authenticated %}
        <div class="container">
            <div class="jumbotron">
                <p>
                    Du ser nu {{ form.sample_year }} års enkät för <b>{{ form.library_name }}</b> i
                    <b>{{ form.municipality_name }}</b>.
                    <br>Enkäten har just nu status <b>{{ form.status|lower }}</b> och är
                    <b>{% if form.is_user_read_only %} stängd {% else %} öppen {% endif %}</b> för respondenten.

                    {% if form.is_published %}
                        <br>
                        <br>Eftersom enkäten har publicerats kan du inte längre ändra status.
                        <br>Däremot kan du fortfarande kontrollera, korrigera och spara enkäten.
                        <br>Du behöver publicera enkäten igen för att ändringar ska synas utåt.
                    {% else %}
                        <br>Här kan du kontrollera, korrigera, spara och ändra status på enkäten.
                    {% endif %}
                </p>

                {% if not form.is_published %}
                    <form id="form-admin" class="form" action="{% url 'surveys_status' form.key.value %}"
                          method="post">
                        {% csrf_token %}
                        {{ form.selected_status }}

                        <div class="form-group">
                            <div class="input-group">
                                <label>Ändra status</label>

                                <div class="dropdown">
                                    <button class="btn btn-default dropdown-toggle" type="button"
                                            data-toggle="dropdown">
                                        {{ form.status }} <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        {% for status in form.statuses %}
                                            {% if status == form.status %}
                                                <li class="active"><a href="#">{{ status }}</a></li>
                                            {% else %}
                                                <li><a href="#">{{ status }}</a></li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                    <button type="submit" class="btn btn-primary">Ändra</button>
                                </div>
                            </div>
                        </div>
                    </form>
                {% endif %}

                <p>
                    <br>Respondenten måste ange lösenordet <b>{{ form.password }}</b> för att svara.
                </p>
            </div>
        </div>
    {% endif %}

    <div class="container container-survey">
        <div class="page-header">
            <h1>Statistikenkät för verksamhetsåret {{ form.sample_year }}</h1>
        </div>
        {% if form.is_user_read_only %}
            {% include "libstat/survey/submitted_notice.html" %}
        {% endif %}
        <div class="row">
            <div class="col-xs-12 col-sm-10 col-md-7">
                <div class="alert alert-info" role="alert">
                    Hej, du svarar på enkäten för <b>{{ form.library_name }}</b> i <b>{{ form.municipality_name }}</b>.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 col-sm-10 col-md-7">
                <p>Välkommen!</p>

                <p>Du har nu kommit till enkäten för Sveriges officiella biblioteksstatistik som gäller för alla
                    offentligt finansierade bibliotekstyper.
                    Tanken med att använda samma formulär till alla bibliotekstyper är att kunna presentera en samlad
                    nationell biblioteksstatistik för offentligt finansierade bibliotek.</p>

            </div>
        </div>
        <form class="survey-content" id="survey-form" method="post">
            {% csrf_token %}
            {{ form.key }}
            {{ form.disabled_inputs }}
            {{ form.submit_action }}
            {{ form.read_only }}

            {% for section in form.sections %}
                <h2 class="section-title">{{ section.title }}</h2>
                {% for group in section.groups %}
                    <div class="panel panel-default inverse">
                        <div class="panel-body">
                            {% if group.description %}
                                <div class="row">
                                    <div class="col-sm-12">
                                        {{ group.description }}
                                    </div>
                                </div>
                                <hr>
                            {% endif %}
                            {% if group.columns == 1 %}{% include "libstat/survey/col-1.html" %}{% endif %}
                            {% if group.columns == 2 %}{% include "libstat/survey/col-2.html" %}{% endif %}
                            {% if group.columns == 3 %}{% include "libstat/survey/col-3.html" %}{% endif %}
                            {% if group.columns == 4 %}{% include "libstat/survey/col-4.html" %}{% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% endfor %}
            {% if not form.is_read_only %}
                <div class="navbar navbar-default navbar-fixed-bottom" role="navigation">
                    <div class="container">
                        <div class="navbar-left">
                            <div class="navbar-text">
                                <span class="answers-text">Du har svarat på 0 av 0 frågor totalt</span>

                                <div class="progress answers-progress" style="width: 250px">
                                    <div class="progress-bar progress-bar-success progress-bar-striped"
                                         role="progressbar">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="navbar-right navbar-submit">
                            <div id="unsaved-changes-label" class="navbar-text"></div>
                            <a href="#" id="save-survey-btn" class="btn btn-primary navbar-btn">Spara</a>
                            <a href="#" id="submit-survey-btn" class="btn btn-success navbar-btn
                                {% if not form.can_submit %} disabled {% endif %}">Skicka</a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </form>
    </div>
    <div class="modal fade" id="submit-confirm-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <p>
                        Är du säker på att du vill skicka in din enkät?
                    </p>

                    <p>
                        När du väl skickat in din enkät kommer vi börja behandla dina inskickade svar och du kommer
                        då inte längre kunna göra några ändringar.
                    </p>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-danger" data-dismiss="modal">Nej</a>
                    <a href="#" id="confirm-submit-survey-btn" class="btn btn-success">Ja</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}